:root {
    /* Paleta de Colores Ergonómica */
    --primary-color: #3498db;          /* Azul principal más suave */
    --primary-hover: #2980b9;          /* Oscurecimiento del azul */
    --light-bg: #f0f4f8;               /* Fondo general (azul-gris muy claro) */
    --card-bg: #ffffff;                /* Fondo para tarjetas y contenedores */
    --text-dark: #2c3e50;              /* Texto principal (gris oscuro azulado) */
    --text-light: #738496;             /* Texto secundario/pequeño */
    --border-color: #dbe2e9;           /* Color de borde suave */
    --success: #27ae60;                /* Verde más suave */
    --success-hover: #229954;          /* Verde más oscuro para hover */
    --danger: #e74c3c;                 /* Rojo más suave */
    --unanswered-color: #95a5a6;       /* Gris para sin contestar */
    --selected-option-bg: #eaf5fc;     /* Fondo opción seleccionada */
    --selected-option-border: #3498db;
    --font-family: 'Montserrat', sans-serif;
    --shadow-light: 0 4px 10px rgba(44, 62, 80, 0.06);
}

/* --- Estilos Generales y de Cuerpo --- */
body {
    font-family: var(--font-family); 
    background-color: var(--light-bg); 
    color: var(--text-dark);
    margin: 0; 
    line-height: 1.5; 
    font-weight: 500;
}
body.modal-open { overflow: hidden; }

/* --- Estructura Principal (Header, Main, Footer) --- */
header, main, footer { padding: 20px 5%; }
nav { display: flex; justify-content: space-between; align-items: center; height: 60px; max-width: 1400px; margin: 0 auto; }
.logo { font-size: 1.4em; font-weight: 700; color: var(--primary-color); text-decoration: none; }
.nav-links a { color: var(--text-light); text-decoration: none; margin-left: 20px; font-weight: 500; font-size: 0.9em; }

/* --- Contenedores y Configuración --- */
#setup-container { max-width: 800px; margin: 0 auto; background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: var(--shadow-light); }
.setup-section h2 { font-size: 1.5em; font-weight: 600; padding-bottom: 8px; margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); }
#materias-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
.materia-card { position: relative; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s ease; }
.materia-card:hover { border-color: var(--primary-color); }
.materia-card input[type="checkbox"] { display: none; }
.materia-card label { display: block; font-weight: 600; font-size: 1em; padding-left: 35px; }
.materia-card label::before, .materia-card label::after { content: ''; position: absolute; left: 15px; top: 18px; transition: all 0.2s; }
.materia-card label::before { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 4px; }
.materia-card label::after { content: '✔'; font-size: 1.4em; color: var(--card-bg); opacity: 0; left: 18px; top: 14px; }
.materia-card input:checked + label::before { background-color: var(--primary-color); border-color: var(--primary-color); }
.materia-card input:checked + label::after { opacity: 1; }
.config-controls { max-width: 450px; }
.slider-container { display: flex; align-items: center; gap: 15px; margin-top: 10px; }
input[type="range"] { flex-grow: 1; accent-color: var(--primary-color); }
input[type="number"] { width: 70px; padding: 8px; text-align: center; border: 1px solid var(--border-color); border-radius: 6px;}
#start-button { display: block; width: 100%; max-width: 450px; margin: 30px auto 0; padding: 15px; font-size: 1.1em; font-weight: 600; color: var(--card-bg); background-color: var(--success); border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
#start-button:disabled { background-color: var(--secondary-color); cursor: not-allowed; opacity: 0.6; }
#start-button:hover:not(:disabled) { background-color: var(--success-hover); transform: translateY(-2px); }

/* --- Layout del Test (Desktop) --- */
#quiz-page-layout { display: flex; gap: 30px; max-width: 1400px; margin: 0 auto; align-items: flex-start; }
#quiz-main-content { flex: 1; min-width: 0; background: var(--card-bg); padding: 25px; border-radius: 10px; box-shadow: var(--shadow-light); }
#quiz-sidebar { width: 280px; flex-shrink: 0; position: sticky; top: 80px; background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: var(--shadow-light); max-height: calc(100vh - 100px); display: flex; flex-direction: column; }
#quiz-sidebar h3 { font-size: 1.2em; color: var(--primary-color); margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; flex-shrink: 0; }
#question-grid { display: flex; flex-wrap: wrap; gap: 8px; overflow-y: auto; flex-grow: 1; }
.grid-item { width: 35px; height: 35px; display: flex; justify-content: center; align-items: center; border: 1px solid var(--border-color); border-radius: 5px; cursor: pointer; font-size: 0.9em; text-decoration: none; color: var(--text-dark); }
#finish-button-container { margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color); flex-shrink: 0; }
#finish-button { width: 100%; padding: 15px; font-size: 1.1em; font-weight: 600; color: var(--card-bg); background-color: var(--success); border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; }
#finish-button:hover { background-color: var(--success-hover); }

/* --- Estilos Internos del Test --- */
#quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
#quiz-title { font-size: 1.5em; font-weight: 600; color: var(--primary-color); }
.question-block { margin-bottom: 25px; padding: 20px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: var(--shadow-light); }
.question-header { display: flex; align-items: flex-start; margin-bottom: 15px; }
.question-number { font-size: 1.2em; font-weight: 700; color: var(--primary-color); margin-right: 15px; line-height: 1.4; }
.question-content { flex: 1; }
.question-theme { display: block; font-size: 0.8em; font-weight: 600; color: var(--text-light); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
.question-text { font-size: 1.1em; font-weight: 500; flex-grow: 1; margin: 0; }
.options-group label { display: block; padding: 12px 15px; margin-bottom: 10px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer; transition: all 0.2s ease; }
.options-group label:hover { background-color: var(--selected-option-bg); }
.options-group input[type="radio"] { display: none; }
.options-group input[type="radio"]:checked + label { border-color: var(--selected-option-border); background-color: var(--selected-option-bg); font-weight: 600; }
.options-group.review-mode label.correct { background-color: #d4edda; border-color: var(--success); }
.options-group.review-mode label.incorrect { background-color: #f8d7da; border-color: var(--danger); }
.options-group.review-mode input:checked + label.incorrect { box-shadow: 0 0 5px var(--danger); }
.explanation { margin-top: 15px; padding: 15px; background-color: #f0f4f8; border-radius: 6px; font-size: 0.95em; line-height: 1.6; }
.grid-item.answered { background-color: var(--selected-option-bg); border-color: var(--selected-option-border); }
.grid-item.correct { background-color: var(--success); border-color: var(--success); color: var(--card-bg); }
.grid-item.incorrect { background-color: var(--danger); border-color: var(--danger); color: var(--card-bg); }
.grid-item.unanswered { background-color: var(--unanswered-color); border-color: var(--unanswered-color); color: var(--card-bg); }

/* --- Ventana Modal y Resultados --- */
#modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(44, 62, 80, 0.85); display: flex; justify-content: center; align-items: center; z-index: 2000; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
#modal-overlay.visible { opacity: 1; pointer-events: auto; }
#results-container { max-width: 600px; width: 90%; background: var(--card-bg); padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); transform: scale(0.95); transition: transform 0.3s ease; }
#modal-overlay.visible #results-container { transform: scale(1); }
#results-container h1 { text-align: center; color: var(--primary-color); margin-top:0; }
.results-summary { text-align: center; font-size: 1.1em; line-height: 1.7; }
.final-grade-container { background: linear-gradient(45deg, var(--primary-color), var(--primary-hover)); color: var(--card-bg); padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; }
.final-grade { font-size: 3em; font-weight: 700; }
.results-buttons { display: flex; justify-content: space-between; margin-top: 30px; gap: 15px; }
#review-button, #restart-button { flex: 1; padding: 15px; font-size: 1em; font-weight: 600; color: var(--card-bg); border: none; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
#review-button { background-color: var(--primary-color); }
#restart-button { background-color: var(--secondary-color); }
#review-button:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
#restart-button:hover { background-color: #5a6268; transform: translateY(-1px); }

/* === NUEVO: Desglose de Resultados por Tema === */
.results-summary h4 {
    margin: 15px 0 10px 0;
    font-size: 1em;
    font-weight: 600;
    color: var(--text-dark);
}
.results-breakdown {
    list-style-type: none;
    padding: 0;
    margin: 10px auto;
    max-width: 85%;
    font-size: 0.9em;
}
.results-breakdown li {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid var(--border-color);
}
.results-breakdown li:last-child {
    border-bottom: none;
}
.results-breakdown li span {
    color: var(--text-light);
}
.results-breakdown li strong {
    color: var(--text-dark);
}
/* === FIN DE NUEVOS ESTILOS === */

.hidden { display: none !important; }

/* --- Vista Móvil --- */
@media (max-width: 992px) {
    #quiz-page-layout { flex-direction: column; }
    #quiz-sidebar { position: fixed; bottom: 0; left: 0; top: auto; width: 100%; max-height: none; box-sizing: border-box; border-radius: 0; border-top: 1px solid var(--border-color); flex-direction: column; padding: 8px 0; z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
    #quiz-sidebar h3 { display: none; }
    #question-grid { width: 100%; overflow-x: auto; flex-wrap: nowrap; padding: 5px 15px; box-sizing: border-box; border: none; scrollbar-width: none; -ms-overflow-style: none; }
    #question-grid::-webkit-scrollbar { display: none; }
    .grid-item { flex-shrink: 0; }
    #finish-button-container { width: 100%; text-align: center; margin-top: 8px; padding: 8px 15px 0 15px; border-top: 1px solid var(--border-color); box-sizing: border-box; }
    #finish-button { width: 100%; max-width: 400px; padding: 12px; font-size: 1em; }
    #quiz-main-content { margin-bottom: 120px; }
}